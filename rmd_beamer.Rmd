---
title: |
  | R Markdown + Beamer
  | プレゼンテーション資料
author: "kottn"
date: '2018-06-13'
output:
  beamer_presentation:
    toc: false
    fig_caption: no
    includes:
      in_header: header.tex
    keep_tex: yes
    latex_engine: lualatex
    theme: "metropolis"
    colortheme: "metropolis"
    #theme: "Singapore"
    #colortheme: "orchid"
    slide_level: 2
    fonttheme: "structurebold"
    highlight: "zenburn"
  slidy_presentation: default
  ioslides_presentation: default
subtitle: '○○大学'
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# はじめに

## 自己紹介

計算工学と災害の研究をしています。

* Twitter: @kottn_jp
* GitHub: https://github.com/kottn


## 参考資料

* https://github.com/ito4303/SappoRoR8



## ありがとうぞうさん


\begin{center}
\includegraphics[width=6cm]{kazutan_SappoRoR6.png}
\end{center}

SappoRo.R #6: R Markdownによるスライド生成（前田さん）

http://kazutan.github.io/SappoRoR6/rmd_slide.html


## ありがとうぞうさん（２）

## その後

>- revealjsをためてしてみた。
    - なかなかよかった。

>- 次はR Markdown + Beamerでやってみよう。

# 内容

## Beamerとは

\Large
\LaTeX でプレゼンテーションファイル(PDF)を作成するパッケージ

## R Markdown + Beamer

RStudioで，R Markdownを新規に作成するときに，
Beamerでプレゼンテーションファイルを作成するオプションあり。

\begin{center}
\includegraphics[width=9cm]{NewRmd.png}
\end{center}


## なぜR Markdown + Beamer

\LARGE
RStudioだけで，数式も，Rコードも，  
グラフもすべて完結。

\normalsize

## 用意したもの

\LARGE

- RStudio

- TeXLive 2017 (MacTeX 2017)

## 使用方法{.fragile}

ふつうにR Markdown

RStudioで，下のようにかいていく。

\begin{lstlisting}
# タイトル

内容
内容
 :
\end{lstlisting}


## yamlヘッダの設定{.fragile}

\begin{lstlisting}[basicstyle={\footnotesize\ttfamily}]
title: |
  | R MarkdownとBeamerで
  | プレゼンテーション資料作成
subtitle: "SappoRo.R #8 @ 北海学園大学"
author: "伊東宏樹"
date: "2018-02-24"
output:
  beamer_presentation:
    theme: default          # テーマ
    latex_engine: lualatex  # lualatexを使用
    keep_tex: true          # texソースをのこす
    includes:
      in_header: header.tex # header.texをよみこむ
    fig_caption: false
\end{lstlisting}

title中の改行は‘|’をいれる。
\footnotesize (https://stackoverflow.com/questions/28895109/how-can-i-force-a-line-break-in-rmarkdowns-title)


## 欧文フォントの設定{.fragile}

`in_header`で指定したファイルで設定。

\begin{lstlisting}[language=TeX]
\usefonttheme[onlymath]{serif}
\usepackage[sc]{mathpazo}        % 数式フォントをカッコよく
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage[scale=1.0]{tgheros}  % Sans serif font
\usepackage[scaled]{beramono}    % Monospace font
\end{lstlisting}

fontencパッケージを使用するようにした。

\small luatex使用の場合，デフォルトのbeamerテンプレートでfontspecパッケージが
呼ばれるが，そうするとupquoteパッケージが有効にならず，コードチャンク中の
二重引用符が「`"`」ではなく「`”`」になってしまうようだ。

## 日本語フォントの設定{.fragile}

日本語フォントの設定は欧文フォントとは別になっている。

この資料では，`in-header`で指定したファイル内で，以下のように
設定した（IPAexフォント使用）。

\begin{lstlisting}[language=TeX]
\usepackage{luatexja-otf}
\usepackage[no-math,match,deluxe,expert,ipaex]{luatexja-preset}
\renewcommand{\kanjifamilydefault}{\gtdefault}
\end{lstlisting}

## luatexjaの設定

luatexjaの公式ドキュメントがくわしい（当然）。

- コマンドラインから`texdoc luatexja`

または

- http://mirrors.ctan.org/macros/luatex/generic/luatexja/doc/luatexja-ja.pdf


## fragile関係のエラー{.fragile}

fancyvrbパッケージのVerbatim環境や，listingsパッケージのlstlisting環境をつかうと，
\begin{Verbatim}[frame=single,fontsize=\scriptsize]
! Illegal parameter number in definition of \beamer@doifinframe.
\end{Verbatim}

\begin{Verbatim}[frame=single,fontsize=\scriptsize]
! Missing \endcsname inserted.
\end{Verbatim}
といったエラーが出る場合がある。

\vspace{12pt}

**解決法:** タイトルのあとに`{.fragile}`をつける。
\begin{lstlisting}
# タイトル{.fragile}

内容
内容
\end{lstlisting}


## 数式{.fragile}

LaTeXなので，数式は問題なし。RStudioではプレビューも表示される。

\begin{lstlisting}[language=TeX]
\[
\Pr(x \mid \mu, \sigma) =
  \frac{1}{\sqrt{2\pi}\sigma}
  \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
\]
\end{lstlisting}

\[
\Pr(x \mid \mu, \sigma) =
  \frac{1}{\sqrt{2\pi}\sigma}
  \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
\]

## Rでグラフ

Rなので，グラフも。

```{r,include=FALSE}
library(ggplot2)
```

しかし，デフォルトでは はみでる。
```{r fig,echo=TRUE}
p <- ggplot(iris, aes(Sepal.Length, Sepal.Width,
                      colour = Species)) +
  geom_point()
print(p)
```

## チャンクでのオプション指定

ドキュメントをみる。

- knitr > Chunk options and package options (Yihui Xieさん)
    - https://yihui.name/knitr/options/#plots

## サイズ調整

チャンクオプションで`fig.width=4,fig.height=2.5`と`out.height="5cm"`を指定した。
```{r fig_size,fig.width=4,fig.height=2.5,out.height="5cm",echo=TRUE}
print(p)
```


## グラフの日本語フォント

チャンクオプションで， `dev="cairo_pdf"`を指定すると，日本語フォントの
表示ができる。

```{r fig_font,fig.width=5,fig.height=2,out.height="4cm",dev="cairo_pdf",echo=TRUE}
spc <- c("ヒオウギアヤメ", "イリス・ウェルシコロル",
         "イリス・ヴァージニカ")
p + labs(x = "萼の長さ(cm)", y = "萼の幅(cm)") +
         scale_colour_discrete(name = "種", labels = spc) +
         theme_grey(base_family = "NotoSansCJKjp-Regular")
```

# まとめ

### Conclusion

>- CSSの知識があれば，revealjsの方が楽かも。
>- でも，なんとかなる。
>- ドキュメントをよむ。
>- 先人の知恵を活用する。
>- いったん設定ができてしまえば，あとは楽?

### Feature work

hogehoge

# Thank you!
    
# Appendix

## movie

\movie[
    loop,
    poster,
    width=1.0\linewidth,
    height=0.56\linewidth
]{Open me more newer Adobe Acrobat PDF viewer}{example.avi}


## This is fortran{.fragile}
    
\begin{lstlisting}[language=Fortran]
program hoge
implicitnone
integer :: hoge
hoge = 1
write(*,*) hoge
end program hoge
\end{lstlisting}


# EOF